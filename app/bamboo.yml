settings:
  artifacts-dir: results/bamboo/%Y-%m-%d_%H-%M-%S
  aggregator: consolidator
  verbose: false
  check-updates: false
  env:
    application_hostname: test-bamboo.atlassian.com
    application_protocol: http
    application_port: 80
    secure: true
    application_postfix: /bamboo
    admin_login: admin
    admin_password: admin
    load_executor: jmeter
    concurrency: 200
    test_duration: 45m
    ramp-up: 5m
    total_actions_per_hour: 2000
    WEBDRIVER_VISIBLE: false
    JMETER_VERSION: 5.4.3
    LANGUAGE: en_US.utf8
    allow_analytics: false
    view_all_builds: 15
    view_build_result: 15
    view_build_configuration: 10
    view_job_configuration: 10
    view_build_summary: 10
    view_projects_list: 10
    standalone_extension: 0
    standalone_extension_locust: 0
    number_of_agents: 50
    parallel_plans_count: 40
    start_plan_timeout: 60
    default_dataset_plan_duration: 60
services:
- module: shellexec
  prepare:
  - python util/pre_run/environment_checker.py
  - python util/data_preparation/bamboo_prepare_data.py
  shutdown:
  - python util/post_run/jmeter_post_check.py
  - python util/jtl_convertor/jtls-to-csv.py kpi*.jtl selenium.jtl
  post-process:
  - python util/analytics/analytics.py bamboo
  - python util/post_run/cleanup_results_dir.py
- module: pip-install
  packages:
  - selenium==4.9.1
execution:
- scenario: jmeter
  executor: jmeter
  concurrency: ${concurrency}
  hold-for: ${test_duration}
  ramp-up: ${ramp-up}
- scenario: locust
  executor: locust
  concurrency: ${parallel_plans_count}
  hold-for: ${test_duration}
  ramp-up: ${default_dataset_plan_duration}
- scenario: selenium
  executor: selenium
  runner: pytest
  hold-for: ${test_duration}
scenarios:
  selenium:
    script: selenium_ui/bamboo_ui.py
  locust:
    script: locustio/bamboo/locustfile.py
  locust_app_specific:
    script: locustio/bamboo/locustfile_app_specific.py
  jmeter:
    script: jmeter/bamboo.jmx
    properties:
      application_hostname: ${application_hostname}
      application_protocol: ${application_protocol}
      application_port: ${application_port}
      application_postfix: ${application_postfix}
      total_actions_per_hr: ${total_actions_per_hour}
      perc_view_all_builds: ${view_all_builds}
      perc_view_build_result: ${view_build_result}
      perc_view_build_configuration: ${view_build_configuration}
      perc_view_job_configuration: ${view_job_configuration}
      perc_view_build_summary: ${view_build_summary}
      perc_view_projects_list: ${view_projects_list}
      perc_standalone_extension: ${standalone_extension}
modules:
  consolidator:
    rtimes-len: 0
    percentiles: []
  jmeter:
    version: ${JMETER_VERSION}
    detect-plugins: true
    memory-xmx: 8G
    plugins:
    - bzm-parallel=0.4
    - bzm-random-csv=0.6
    - jpgc-casutg=2.5
    - jpgc-dummy=0.2
    - jpgc-ffw=2.0
    - jpgc-fifo=0.2
    - jpgc-functions=2.1
    - jpgc-json=2.6
    - jpgc-perfmon=2.1
    - jpgc-prmctl=0.4
    - jpgc-tst=2.4
    - jpgc-wsc=0.3
    - tilln-sshmon=1.0
    - jpgc-synthesis=2.2
    system-properties:
      server.rmi.ssl.disable: true
      java.rmi.server.hostname: localhost
      httpsampler.ignore_failed_embedded_resources: 'true'
  selenium:
    chromedriver:
      version: 113.0.5672.63
reporting:
- data-source: sample-labels
  module: junit-xml
